(function(){"use strict";this.Trux={createSubClass:function(t,e){var o="function"==typeof e?e:Trux.Model,n=function(t){o.call(this,t)};if(n.prototype=Object.create(o.prototype),"object"!=typeof t)return n;for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i]);return n},models:{},collections:{},Base:function(){function t(){if(Object.keys(e.components).length)for(var t in e.components)e.components.hasOwnProperty(t)&&e.components[t].appDataDidChange()}var e=this;this.components={},this.emitter=new EventEmitter,this.emitter.addListener("change",t),this.requestOptions={},this.GET=!1,this.POST=!1,this.PUT=!1,this.PATCH=!1,this.DELETE=!1}},Trux.Base.prototype.bindComponent=function(t){this.components[t.truxId]=t},Trux.Base.prototype.unbindComponent=function(t){"undefined"!=typeof this.components[t.truxId]&&delete this.components[t.truxId]},Trux.Base.prototype.emitChangeEvent=function(){this.emitter.emitEvent("change")},Trux.Base.prototype.setRequestOptions=function(t){return this.requestOptions=t,this}}).call(this),function(t){"use strict";t.Model=function(e){t.Base.call(this);var o=null;return this.id=null,this.data=e,this.backup=null,this.collection=!1,this.className="TruxModel",this.setData=function(t){return this.data=t,o=JSON.parse(JSON.stringify(t)),this},this.restoreData=function(){return this.data=JSON.parse(JSON.stringify(o)),this},this},t.Model.prototype=Object.create(t.Base.prototype),t.Model.prototype.setId=function(t){return this.id=t,this},t.Model.prototype.getId=function(){return this.data.id},t.Model.prototype.persist=function(){return this.collection?this.collection.emitChangeEvent():this.emitChangeEvent(),this},t.Model.prototype.fetch=function(t){var e=this;return qwest.get(this.GET,null,this.requestOptions).then(function(o,n){"object"==typeof n&&(e.setData(n),"function"==typeof t.onDone&&t.onDone(n))})["catch"](function(e,o,n){"function"==typeof t.onFail&&t.onFail(e,o,n)}),this},t.Model.prototype.create=function(t,e){return qwest.post(this.POST,t,this.requestOptions).then(function(t,o){console.log(o),"object"==typeof o&&(_this.setData(o),"function"==typeof e.onDone&&e.onDone(o))})["catch"](function(t,o,n){"function"==typeof e.onFail&&e.onFail(t,o,n)}),this},t.Model.prototype.update=function(t,e){var o=this;return qwest.put(this.PUT,t,this.requestOptions).then(function(t,n){"object"==typeof n&&(o.setData(n).persist(),"function"==typeof e.onDone&&e.onDone(n))})["catch"](function(t,n,i){o.restoreData().persist(),"function"==typeof e.onFail&&e.onFail(t,n,i)}),this},t.Model.prototype.purge=function(){this.data=null}}(Trux),function(t){"use strict";t.Collection=function(e){t.Base.call(this);return this.modelConstructor=e,this.models=[],this.className="TruxCollection",this},t.Collection.prototype=Object.create(t.Base.prototype),t.Collection.prototype.fetch=function(t){var e=this;return qwest.get(this.GET,null,this.requestOptions).then(function(o,n){e.setModels(n),t&&"function"==typeof t.onDone&&t.onDone(n)})["catch"](function(e,o,n){t&&"function"==typeof t.onFail&&t.onFail(e,o,n)}),this},t.Collection.prototype.setModels=function(t){if(Array.isArray(t)){this.purgeModels();var e,o=t.length;for(e=0;o>e;e++){var n=new this.modelConstructor(t[e]);this.append(n)}return this}},t.Collection.prototype.findById=function(t){var e,o=this.models.length,n=!1;for(e=0;o>e;e++)(this.models[e].data.id==t||this.models[e].data.id==parseInt(t,10))&&(n=this.models[e]);return n},t.Collection.prototype.append=function(t){t.collection=this,this.models.push(t)},t.Collection.prototype.prepend=function(t){t.collection=_this,this.models.unshift(t)},t.Collection.prototype.purgeModels=function(){this.models=[]}}(Trux);