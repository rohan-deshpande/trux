(function(){"use strict";this.Trux={extend:function(t,e,o){console.log("Trux.extend will be deprecated soon, please use Trux.Model.extend or Trux.Collection.extend instead");var n="function"==typeof o?o:Trux.Model,i=function(t){n.call(this,t),"function"==typeof e&&e(this)};if(i.prototype=Object.create(n.prototype),"object"!=typeof t)return i;for(var s in t)t.hasOwnProperty(s)&&(i.prototype[s]=t[s]);return i},models:{},collections:{},Base:function(){function t(){if(Object.keys(e.components).length)for(var t in e.components)e.components.hasOwnProperty(t)&&e.components[t].appDataDidChange()}var e=this;this.components={},this.emitter=new EventEmitter,this.emitter.addListener("change",t),this.requestOptions={},this.GET=!1,this.POST=!1,this.PUT=!1,this.PATCH=!1,this.DELETE=!1}},Trux.Base.prototype.bindComponent=function(t){this.components[t.truxId]=t},Trux.Base.prototype.unbindComponent=function(t){"undefined"!=typeof this.components[t.truxId]&&delete this.components[t.truxId]},Trux.Base.prototype.emitChangeEvent=function(){this.emitter.emitEvent("change")},Trux.Base.prototype.setRequestOptions=function(t){return this.requestOptions=t,this}}).call(this),function(t){"use strict";t.Model=function(e){t.Base.call(this);var o=e&&0!==Object.keys(e).length?JSON.parse(JSON.stringify(e)):{};return this.data=e,this.collection=!1,this.className="TruxModel",this.setData=function(t){this.data=t,o=t&&0!==Object.keys(t).length?JSON.parse(JSON.stringify(t)):{}},this.restoreData=function(){this.data=o&&0!==Object.keys(o).length?JSON.parse(JSON.stringify(o)):{}},this},t.Model.prototype=Object.create(t.Base.prototype),t.Model.prototype.persist=function(){var t=this;return t.collection?void t.collection.fetch({onDone:function(){t.collection.emitChangeEvent()}}):void this.emitChangeEvent()},t.Model.prototype.fetch=function(t){var e=this;return qwest.get(this.GET,null,this.requestOptions).then(function(o,n){"object"==typeof n&&(e.setData(n),"function"==typeof t.onDone&&t.onDone(n))})["catch"](function(e,o,n){"function"==typeof t.onFail&&t.onFail(e,o,n)}),this},t.Model.prototype.create=function(t,e){var o=this;return qwest.post(this.POST,t,this.requestOptions).then(function(t,n){"object"==typeof n&&(o.setData(n),"function"==typeof e.onDone&&e.onDone(n))})["catch"](function(t,o,n){"function"==typeof e.onFail&&e.onFail(t,o,n)}),this},t.Model.prototype.update=function(t,e){var o=this;return qwest.put(this.PUT,t,this.requestOptions).then(function(t,n){"object"==typeof n&&(o.setData(n),o.persist(),"function"==typeof e.onDone&&e.onDone(n))})["catch"](function(t,n,i){o.restoreData(),o.persist(),"function"==typeof e.onFail&&e.onFail(t,n,i)}),this},t.Model.prototype.purge=function(){this.data=null},t.Model.extend=function(e,o){var n=function(e){t.Model.call(this,e),"function"==typeof o&&o(this)};if(n.prototype=Object.create(t.Model.prototype),"object"!=typeof e)return n;for(var i in e)e.hasOwnProperty(i)&&(n.prototype[i]=e[i]);return n},t.Model.modify=function(e){if("object"!=typeof e)return this;for(var o in e)e.hasOwnProperty(o)&&(t.Model.prototype[o]=e[o]);return this}}(Trux),function(t){"use strict";t.Collection=function(e){t.Base.call(this);return this.modelConstructor=e,this.models=[],this.className="TruxCollection",this},t.Collection.prototype=Object.create(t.Base.prototype),t.Collection.prototype.fetch=function(t){var e=this;return qwest.get(this.GET,null,this.requestOptions).then(function(o,n){e.setModels(n),t&&"function"==typeof t.onDone&&t.onDone(n)})["catch"](function(e,o,n){t&&"function"==typeof t.onFail&&t.onFail(e,o,n)}),this},t.Collection.prototype.setModels=function(t){if(Array.isArray(t)){this.purgeModels();var e,o=t.length;for(e=0;e<o;e++){var n=new this.modelConstructor(t[e]);this.append(n)}}},t.Collection.prototype.append=function(t){t.collection=this,this.models.push(t)},t.Collection.prototype.prepend=function(t){t.collection=this,this.models.unshift(t)},t.Collection.prototype.purgeModels=function(){this.models=[]},t.Collection.extend=function(e,o){var n=function(e){t.Collection.call(this,e),"function"==typeof o&&o(this)};if(n.prototype=Object.create(t.Collection.prototype),"object"!=typeof e)return n;for(var i in e)e.hasOwnProperty(i)&&(n.prototype[i]=e[i]);return n},t.Collection.modify=function(e){if("object"!=typeof e)return this;for(var o in e)e.hasOwnProperty(o)&&(t.Collection.prototype[o]=e[o]);return this}}(Trux);