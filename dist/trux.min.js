!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("trux",[],t):"object"==typeof exports?exports.trux=t():e.trux=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),s=function(e){return e&&e.__esModule?e:{default:e}}(i),u=function(){function e(){function t(){if(n.wasBroadcast=!0,Object.keys(n.components).length)for(var e in n.components)n.components.hasOwnProperty(e)&&n.components[e].storeDidUpdate()}r(this,e);var n=this;this.components={},this.emitter=new s.default,this.requestHeaders={"Content-Type":"application/json"},this.GET="",this.POST="",this.PUT="",this.PATCH="",this.DELETE="",this.wasBroadcast=!1,this.wasFetched=!1,this.emitter.addListener("change",t)}return o(e,[{key:"connect",value:function(e){if(void 0===e.truxid)throw new ReferenceError("You must set a truxid on your component before connecting it to a store.");this.components[e.truxid]=e,"function"!=typeof e.storeDidUpdate&&console.warn("The component you have connected to this store does not contain a storeDidUpdate method.")}},{key:"disconnect",value:function(e){if(void 0===this.components[e.truxid])throw new ReferenceError("The component you are attempting to disconnect is not connected to this store.");delete this.components[e.truxid]}},{key:"close",value:function(){for(var e in this.components)this.components.hasOwnProperty(e)&&delete this.components[e];return this}},{key:"emitChangeEvent",value:function(){this.emitter.emitEvent("change")}},{key:"addRequestHeader",value:function(e,t){return this.requestHeaders[e]=t,this}},{key:"deleteRequestHeader",value:function(e){return delete this.requestHeaders[e],this}},{key:"getUnixTimestamp",value:function(){return Date.now()}},{key:"requestHeaders",set:function(e){this._requestHeaders=e},get:function(){return this._requestHeaders}},{key:"wasBroadcast",set:function(e){this._wasBroadcast=!!e,this._wasBroadcastAt=e?this.getUnixTimestamp():this.wasBroadcastAt},get:function(){return this._wasBroadcast}},{key:"wasBroadcastAt",get:function(){return this._wasBroadcastAt}},{key:"wasFetched",set:function(e){this._wasFetched=!!e,this._wasFetchedAt=e?this.getUnixTimestamp():this.wasFetchedAt},get:function(){return this._wasFetched}},{key:"wasFetchedAt",get:function(){return this._wasFetchedAt}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function r(e,t){return fetch(e,{method:t.method.toUpperCase()||s.method,headers:t.headers||s.headers,body:t.body?JSON.stringify(t.body):s.body}).then(function(e){var t=e.headers.get("Content-Type");if(t&&t.indexOf("application/json")<0)throw new TypeError("Content-Type of response is not application/json");return e.ok?e.text().then(function(t){return e.json=(0,i.isJson)(t)?JSON.parse(t):null,Promise.resolve(e)}):e.text().then(function(t){return e.json=(0,i.isJson)(t)?JSON.parse(t):null,Promise.reject(e)})}).catch(function(e){return"object"!==(void 0===e?"undefined":o(e))&&console.error(e),Promise.reject(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULTS=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.json=r;var i=n(1),s=t.DEFAULTS={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},body:null}},function(e,t,n){"use strict";function r(e){try{JSON.parse(e)}catch(e){return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.isJson=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=function(){function e(){r(this,e)}return o(e,null,[{key:"json",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.DEFAULTS;if(!e)throw new Error("You must provide a url resource to fetch");return(0,i.json)(e,t)}}]),e}();t.default=s,e.exports=t.default}])})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),f=r(c),l=n(1),h=r(l),d=function(e){function t(e){var n;o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if("function"!=typeof e)throw new TypeError("You must supply a model constructor to a collection");return r.model=e,r.models=[],n=r,i(r,n)}return s(t,e),a(t,[{key:"fill",value:function(e){var t=e.length;if(!Array.isArray(e))throw new TypeError("collections can only be filled with arrays of models");this.purge();for(var n=0;n<t;n++)this.append(new this.model(e[n]));return this}},{key:"append",value:function(e){if(!(e instanceof this.model))throw new Error("collections can only contain one kind of trux model");return e.collection=this,this.models.push(e),this}},{key:"prepend",value:function(e){if(!(e instanceof this.model))throw new Error("collections can only contain one kind of trux model");return e.collection=this,this.models.unshift(e),this}},{key:"purge",value:function(){for(var e=this.models.length,t=0;t<e;t++)this.models[t].collection=!1;this.models=[]}},{key:"persist",value:function(){return this.emitChangeEvent(),this}},{key:"fetch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h.default.json(""+this.GET+t,{method:"GET",headers:this.requestHeaders}).then(function(t){return e.wasFetched=!0,e.fill(t.json).persist(),Promise.resolve(t)}).catch(function(t){return e.wasFetched=!1,Promise.reject(t)})}}],[{key:"extend",value:function(e,n){var r=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"function"==typeof n&&n(r),r}return s(t,e),t}(t);if("object"===(void 0===e?"undefined":u(e)))for(var a in e)e.hasOwnProperty(a)&&(r.prototype[a]=e[a]);return r}},{key:"modify",value:function(e){if("object"!==(void 0===e?"undefined":u(e)))throw new TypeError("You must modify Collection with a properties object");for(var n in e)e.hasOwnProperty(n)&&(t.prototype[n]=e[n])}}]),t}(f.default);t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),f=r(c),l=n(1),h=r(l),d=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e&&0!==Object.keys(e).length?JSON.parse(JSON.stringify(e)):{};return n.data=e||null,n.collection=!1,n.wasUpdated=!1,n.wasCreated=!1,n.wasDestroyed=!1,n.fill=function(e){return n.data=e,r=e&&0!==Object.keys(e).length?JSON.parse(JSON.stringify(e)):{},n},n.restore=function(){return n.data=r&&0!==Object.keys(r).length?JSON.parse(JSON.stringify(r)):{},n},n}return s(t,e),a(t,[{key:"persist",value:function(){return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.collection&&this.collection.emitChangeEvent(),this.emitChangeEvent(),this}},{key:"fetch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return h.default.json(""+this.GET+t,{method:"GET",headers:this.requestHeaders}).then(function(t){return e.wasFetched=!0,e.fill(t.json).persist(),Promise.resolve(t)}).catch(function(t){return e.wasFetched=!1,Promise.reject(t)})}},{key:"create",value:function(e){var t=this;return h.default.json(this.POST,{method:"POST",headers:this.requestHeaders,body:e}).then(function(e){return t.wasCreated=!0,t.fill(e.json).persist(),Promise.resolve(e)}).catch(function(e){return t.wasCreated=!1,Promise.reject(e)})}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.data||this.data,r=t.method||"PUT",o=t.optimistic||!1,i=t.collection||!0;return o&&this.persist(i),h.default.json(this[r],{method:r,headers:this.requestHeaders,body:n}).then(function(t){return e.wasUpdated=!0,e.fill(t.json).persist(i),Promise.resolve(t)}).catch(function(t){return e.wasUpdated=!1,e.restore().persist(),Promise.reject(t)})}},{key:"destroy",value:function(){var e=this;return h.default.json(this.DELETE,{method:"DELETE",headers:this.requestHeaders}).then(function(t){return e.wasDestroyed=!0,e.purge().close(),Promise.resolve(t)}).catch(function(t){return e.wasDestroyed=!1,e.restore().persist(),Promise.reject(t)})}},{key:"purge",value:function(){return this.data=null,this}},{key:"wasCreated",set:function(e){this._wasCreated=!!e,this._wasCreatedAt=e?this.getUnixTimestamp():this.wasCreatedAt},get:function(){return this._wasCreated}},{key:"wasCreatedAt",get:function(){return this._wasCreatedAt}},{key:"wasUpdated",set:function(e){this._wasUpdated=!!e,this._wasUpdatedAt=e?this.getUnixTimestamp():this.wasUpdatedAt},get:function(){return this._wasUpdated}},{key:"wasUpdatedAt",get:function(){return this._wasUpdatedAt}},{key:"wasDestroyed",set:function(e){this._wasDestroyed=!!e,this._wasDestroyedAt=e?this.getUnixTimestamp():this.wasDestroyedAt},get:function(){return this._wasDestroyed}},{key:"wasDestroyedAt",get:function(){return this._wasDestroyedAt}}],[{key:"extend",value:function(e,n){var r=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"function"==typeof n&&n(r),r}return s(t,e),t}(t);if("object"===(void 0===e?"undefined":u(e)))for(var a in e)e.hasOwnProperty(a)&&(r.prototype[a]=e[a]);return r}},{key:"modify",value:function(e){if("object"!==(void 0===e?"undefined":u(e)))throw new TypeError("You must modify Model with a properties object");for(var n in e)e.hasOwnProperty(n)&&(t.prototype[n]=e[n])}}]),t}(f.default);t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Collection=t.Model=void 0;var o=n(3),i=r(o),s=n(2),u=r(s);t.Model=i.default,t.Collection=u.default},function(e,t,n){var r;(function(){"use strict";function t(){}function o(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}var s=t.prototype,u=this,a=u.EventEmitter;s.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},s.addListener=function(e,t){var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===o(r[n],t)&&r[n].push(i?t:{listener:t,once:!1});return this},s.on=i("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=i("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(n=o(i[r],t))&&i[r].splice(n,1);return this},s.off=i("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var r,o,i=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(o=t[r])&&("function"==typeof o?i.call(this,r,o):s.call(this,r,o));return this},s.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},s.removeAllListeners=i("removeEvent"),s.emitEvent=function(e,t){var n,r,o,i,s=this.getListenersAsObject(e);for(i in s)if(s.hasOwnProperty(i))for(n=s[i].slice(0),o=n.length;o--;)r=n[o],!0===r.once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},s.trigger=i("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return u.EventEmitter=a,t},void 0!==(r=function(){return t}.call(u,n,u,e))&&(e.exports=r)}).call(this)}])});